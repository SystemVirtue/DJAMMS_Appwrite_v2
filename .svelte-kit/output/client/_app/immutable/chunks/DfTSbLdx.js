var R=Object.defineProperty;var q=(o,r,s)=>r in o?R(o,r,{enumerable:!0,configurable:!0,writable:!0,value:s}):o[r]=s;var k=(o,r,s)=>q(o,typeof r!="symbol"?r+"":r,s);import{S as h,i as b,s as A,q as u,r as I,u as g,v as m,w as v,x as w,y as P,z as f,A as S,B as D,C as F,D as T}from"./BdqU9rtY.js";import{I as N,g as L,a as C}from"./Dp8WnmVE.js";import"./IHki7fMi.js";import{a as d,b as _,e as p,Q as $}from"./zxdJXzVg.js";function j(o){let r;const s=o[2].default,t=S(s,o,o[3],null);return{c(){t&&t.c()},l(a){t&&t.l(a)},m(a,e){t&&t.m(a,e),r=!0},p(a,e){t&&t.p&&(!r||e&8)&&D(t,s,a,a[3],r?T(s,a[3],e,null):F(a[3]),null)},i(a){r||(m(t,a),r=!0)},o(a){g(t,a),r=!1},d(a){t&&t.d(a)}}}function O(o){let r,s;const t=[{name:"more-horizontal"},o[1],{iconNode:o[0]}];let a={$$slots:{default:[j]},$$scope:{ctx:o}};for(let e=0;e<t.length;e+=1)a=u(a,t[e]);return r=new N({props:a}),{c(){P(r.$$.fragment)},l(e){w(r.$$.fragment,e)},m(e,i){v(r,e,i),s=!0},p(e,[i]){const n=i&3?L(t,[t[0],i&2&&C(e[1]),i&1&&{iconNode:e[0]}]):{};i&8&&(n.$$scope={dirty:i,ctx:e}),r.$set(n)},i(e){s||(m(r.$$.fragment,e),s=!0)},o(e){g(r.$$.fragment,e),s=!1},d(e){I(r,e)}}}function Y(o,r,s){let{$$slots:t={},$$scope:a}=r;const e=[["circle",{cx:"12",cy:"12",r:"1"}],["circle",{cx:"19",cy:"12",r:"1"}],["circle",{cx:"5",cy:"12",r:"1"}]];return o.$$set=i=>{s(1,r=u(u({},r),f(i))),"$$scope"in i&&s(3,a=i.$$scope)},r=f(r),[e,r,t,a]}class H extends h{constructor(r){super(),b(this,r,Y,O,A,{})}}function J(o){let r;const s=o[2].default,t=S(s,o,o[3],null);return{c(){t&&t.c()},l(a){t&&t.l(a)},m(a,e){t&&t.m(a,e),r=!0},p(a,e){t&&t.p&&(!r||e&8)&&D(t,s,a,a[3],r?T(s,a[3],e,null):F(a[3]),null)},i(a){r||(m(t,a),r=!0)},o(a){g(t,a),r=!1},d(a){t&&t.d(a)}}}function M(o){let r,s;const t=[{name:"plus"},o[1],{iconNode:o[0]}];let a={$$slots:{default:[J]},$$scope:{ctx:o}};for(let e=0;e<t.length;e+=1)a=u(a,t[e]);return r=new N({props:a}),{c(){P(r.$$.fragment)},l(e){w(r.$$.fragment,e)},m(e,i){v(r,e,i),s=!0},p(e,[i]){const n=i&3?L(t,[t[0],i&2&&C(e[1]),i&1&&{iconNode:e[0]}]):{};i&8&&(n.$$scope={dirty:i,ctx:e}),r.$set(n)},i(e){s||(m(r.$$.fragment,e),s=!0)},o(e){g(r.$$.fragment,e),s=!1},d(e){I(r,e)}}}function U(o,r,s){let{$$slots:t={},$$scope:a}=r;const e=[["path",{d:"M5 12h14"}],["path",{d:"M12 5v14"}]];return o.$$set=i=>{s(1,r=u(u({},r),f(i))),"$$scope"in i&&s(3,a=i.$$scope)},r=f(r),[e,r,t,a]}class K extends h{constructor(r){super(),b(this,r,U,M,A,{})}}const c=class c{static getInstance(){return c.instance||(c.instance=new c),c.instance}parseTracksFromResponse(r){try{if(console.log("parseTracksFromResponse - response.tracks type:",typeof r.tracks),console.log("parseTracksFromResponse - response.tracks value:",r.tracks),r.tracks&&typeof r.tracks=="object"&&r.tracks.tracks&&Array.isArray(r.tracks.tracks))return console.log(`Parsed ${r.tracks.tracks.length} tracks from direct nested object`),r.tracks.tracks;if(r.tracks&&typeof r.tracks=="string"){console.log("Parsing tracks from JSON string...");const s=JSON.parse(r.tracks);if(Array.isArray(s))return console.log(`Parsed ${s.length} tracks from tracks field`),s;if(s&&typeof s=="object"&&s.tracks&&Array.isArray(s.tracks))return console.log(`Parsed ${s.tracks.length} tracks from nested tracks object`),s.tracks}if(r.tracks_array&&Array.isArray(r.tracks_array)){console.log("Parsing tracks from JSON string array...");const s=r.tracks_array.map(t=>typeof t=="string"?JSON.parse(t):t);return console.log(`Parsed ${s.length} tracks from tracks_array field`),s}return r.tracks_array&&Array.isArray(r.tracks_array)?(console.log("Using tracks_array as direct object array..."),r.tracks_array):(console.warn("No parseable tracks found in response"),[])}catch(s){return console.error("Error parsing tracks:",s),[]}}async getGlobalDefaultPlaylist(){var r,s;try{console.log("Fetching global default playlist from Appwrite...");const t=await d.getDocument(_,p.PLAYLISTS,"global_default_playlist");return console.log("Successfully found global default playlist:",{id:t.$id,name:t.name,tracks_count:((r=this.parseTracksFromResponse(t))==null?void 0:r.length)||0,is_public:t.is_public}),{$id:t.$id,$collectionId:t.$collectionId,$databaseId:t.$databaseId,$createdAt:t.$createdAt,$updatedAt:t.$updatedAt,$permissions:t.$permissions||[],playlist_id:t.playlist_id||t.$id,name:t.name,description:t.description,owner_id:t.owner_id||t.user_id,venue_id:t.venue_id,is_public:t.is_public,is_default:t.is_default,is_starred:t.is_starred,category:t.category,cover_image_url:t.cover_image_url||t.thumbnail,tracks:this.parseTracksFromResponse(t)||[],track_count:t.track_count||((s=this.parseTracksFromResponse(t))==null?void 0:s.length)||0,total_duration:t.total_duration,tags:t.tags,play_count:t.play_count,last_played_at:t.last_played_at,created_at:t.created_at||t.$createdAt,updated_at:t.updated_at||t.$updatedAt,user_id:t.user_id,isPublic:t.is_public,isDefault:t.is_default,isStarred:t.is_starred,coverImage:t.cover_image_url||t.thumbnail,trackCount:t.track_count,totalDuration:t.total_duration,updated:t.updated_at||t.$updatedAt,created:t.created_at||t.$createdAt,id:t.$id}}catch(t){return console.error("Failed to fetch global default playlist:",t),console.log("Falling back to demo playlists..."),null}}async getUserPlaylists(r){try{console.log("Fetching user playlists from Appwrite...");const s=[$.limit(100)];r?s.push($.equal("user_id",r)):s.push($.equal("is_public",!0));const a=(await d.listDocuments(_,p.PLAYLISTS,s)).documents.map(e=>{var i;return{$id:e.$id,$collectionId:e.$collectionId,$databaseId:e.$databaseId,$createdAt:e.$createdAt,$updatedAt:e.$updatedAt,$permissions:e.$permissions||[],playlist_id:e.playlist_id||e.$id,name:e.name,description:e.description,owner_id:e.owner_id||e.user_id,venue_id:e.venue_id,is_public:e.is_public,is_default:e.is_default,is_starred:e.is_starred,category:e.category,cover_image_url:e.cover_image_url||e.thumbnail,tracks:this.parseTracksFromResponse(e)||[],track_count:e.track_count||((i=this.parseTracksFromResponse(e))==null?void 0:i.length)||0,total_duration:e.total_duration,tags:e.tags,play_count:e.play_count,last_played_at:e.last_played_at,created_at:e.created_at||e.$createdAt,updated_at:e.updated_at||e.$updatedAt,user_id:e.user_id,isPublic:e.is_public,isDefault:e.is_default,isStarred:e.is_starred,coverImage:e.cover_image_url||e.thumbnail,trackCount:e.track_count,totalDuration:e.total_duration,updated:e.updated_at||e.$updatedAt,created:e.created_at||e.$createdAt,id:e.$id}});return console.log(`Successfully loaded ${a.length} playlists from Appwrite`),a}catch(s){throw console.error("Failed to fetch user playlists:",s),s}}async createPlaylist(r,s,t="",a=!1,e=[]){var i;try{console.log("Creating new playlist:",s);const n={user_id:r,name:s,description:t,is_public:a,tracks:e,thumbnail:e.length>0?e[0].thumbnail:null},l=await d.createDocument(_,p.PLAYLISTS,"unique()",n);return console.log("Created playlist:",l),{$id:l.$id,$collectionId:l.$collectionId,$databaseId:l.$databaseId,$createdAt:l.$createdAt,$updatedAt:l.$updatedAt,$permissions:l.$permissions||[],playlist_id:l.playlist_id||l.$id,name:l.name,description:l.description,owner_id:l.owner_id||l.user_id,venue_id:l.venue_id,is_public:l.is_public,is_default:l.is_default,is_starred:l.is_starred,category:l.category,cover_image_url:l.cover_image_url||l.thumbnail,tracks:l.tracks||[],track_count:l.track_count||((i=l.tracks)==null?void 0:i.length)||0,total_duration:l.total_duration,tags:l.tags,play_count:l.play_count,last_played_at:l.last_played_at,created_at:l.created_at||l.$createdAt,updated_at:l.updated_at||l.$updatedAt,user_id:l.user_id,isPublic:l.is_public,isDefault:l.is_default,isStarred:l.is_starred,coverImage:l.cover_image_url||l.thumbnail,trackCount:l.track_count,totalDuration:l.total_duration,updated:l.updated_at||l.$updatedAt,created:l.created_at||l.$createdAt,id:l.$id}}catch(n){throw console.error("Failed to create playlist:",n),n}}async updatePlaylist(r,s){var t;try{console.log("Updating playlist:",r);const a=await d.updateDocument(_,p.PLAYLISTS,r,s);return console.log("Updated playlist:",a),{$id:a.$id,$collectionId:a.$collectionId,$databaseId:a.$databaseId,$createdAt:a.$createdAt,$updatedAt:a.$updatedAt,$permissions:a.$permissions||[],playlist_id:a.playlist_id||a.$id,name:a.name,description:a.description,owner_id:a.owner_id||a.user_id,venue_id:a.venue_id,is_public:a.is_public,is_default:a.is_default,is_starred:a.is_starred,category:a.category,cover_image_url:a.cover_image_url||a.thumbnail,tracks:a.tracks||[],track_count:a.track_count||((t=a.tracks)==null?void 0:t.length)||0,total_duration:a.total_duration,tags:a.tags,play_count:a.play_count,last_played_at:a.last_played_at,created_at:a.created_at||a.$createdAt,updated_at:a.updated_at||a.$updatedAt,user_id:a.user_id,isPublic:a.is_public,isDefault:a.is_default,isStarred:a.is_starred,coverImage:a.cover_image_url||a.thumbnail,trackCount:a.track_count,totalDuration:a.total_duration,updated:a.updated_at||a.$updatedAt,created:a.created_at||a.$createdAt,id:a.$id}}catch(a){throw console.error("Failed to update playlist:",a),a}}async deletePlaylist(r){try{console.log("Deleting playlist:",r),await d.deleteDocument(_,p.PLAYLISTS,r),console.log("Deleted playlist successfully")}catch(s){throw console.error("Failed to delete playlist:",s),s}}getFallbackPlaylists(){return console.log("Note: Fallback playlists requested - this should rarely happen with working Appwrite connection"),[]}};k(c,"instance");let y=c;const V=y.getInstance();export{H as M,K as P,V as p};
