var o=Object.defineProperty;var l=(n,e,t)=>e in n?o(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t;var i=(n,e,t)=>l(n,typeof e!="symbol"?e+"":e,t);import"./zxdJXzVg.js";import{I as r}from"./BGpGyOKF.js";class h{constructor(){i(this,"channel",null);i(this,"instanceId",null);this.channel=new BroadcastChannel("djamms-player-sync"),this.channel.addEventListener("message",this.handleMessage.bind(this))}initialize(){this.instanceId=r.dashboard(),console.log("PlayerSync initialized for dashboard:",this.instanceId)}initializeForWindow(){this.instanceId=r.window(),console.log("PlayerSync initialized for window:",this.instanceId),this.requestCurrentStatus()}handleMessage(e){const{type:t,instanceId:s,status:a,timestamp:d}=e.data;if(s!==this.instanceId)switch(console.log("PlayerSync received message:",e.data),t){case"player-state-change":console.log("ðŸŽµ PlayerSync: Received player state change:",a,"from instance:",s);break;case"track-change-request":const{track:c}=e.data;c&&(console.log("PlayerSync: Received track change request:",c.title),window.dispatchEvent(new CustomEvent("track-change-request",{detail:c})));break;case"request-status":this.broadcastCurrentStatus();break;case"status-response":console.log("PlayerSync: Received status response:",a);break;case"player-disconnection":a==="no-connected-player"&&console.log("PlayerSync: Player disconnected");break}}broadcastStateChange(e,t){if(!this.channel)return;const s={type:"player-state-change",instanceId:t||this.instanceId,status:e,timestamp:new Date().toISOString()};console.log("Broadcasting state change:",s),this.channel.postMessage(s)}requestCurrentStatus(){if(!this.channel)return;const e={type:"request-status",instanceId:this.instanceId,timestamp:new Date().toISOString()};console.log("Requesting current status:",e),this.channel.postMessage(e)}broadcastCurrentStatus(){if(!this.channel)return;const t={type:"status-response",instanceId:this.instanceId,status:"no-connected-player",timestamp:new Date().toISOString()};console.log("Broadcasting current status:",t),this.channel.postMessage(t)}broadcastDisconnection(e){if(!this.channel)return;const t={type:"player-disconnection",instanceId:e||this.instanceId,status:"no-connected-player",timestamp:new Date().toISOString()};console.log("Broadcasting disconnection:",t),this.channel.postMessage(t)}requestTrackChange(e){if(!this.channel)return;const t={type:"track-change-request",instanceId:this.instanceId,track:e,timestamp:new Date().toISOString()};console.log("Broadcasting track change request:",t),this.channel.postMessage(t)}destroy(){this.channel&&(this.channel.close(),this.channel=null),this.instanceId=null}}const p=new h;export{p};
